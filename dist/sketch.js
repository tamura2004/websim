!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e){function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function r(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}new p5(function(t){var e,n,o,s,a=[],l=[],h=[],u=null,f=null,c=["#c93a40","#0074bf","#56a764","#de9610","#65ace4","#f2cf01","#d16b16"],d=4,p=function(){function t(){i(this,t),this.right=[],this.left=[]}return r(t,[{key:"both",get:function(){return this.right.concat(this.left)}}]),t}(),y=function(){function t(){i(this,t),this.right=null,this.left=null}return r(t,[{key:"shape",get:function(){return this.right?this.left?"BOTH":"RIGHT":this.left?"LEFT":"NONE"}}]),t}(),v=function(){function t(){i(this,t),this.right=[],this.left=[]}return r(t,[{key:"shape",get:function(){return this.right.length>0?this.left.length>0?"BOTH":"RIGHT":this.left.length>0?"LEFT":"NONE"}},{key:"both",get:function(){return this.right.concat(this.left)}}]),t}(),w=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:d;i(this,e),this.speed=t,this.tasks=new p,this.nodes=new y}return r(e,[{key:"reset",value:function(){this.tasks=new p}},{key:"push",value:function(t){if("RIGHT"!==t.direction&&"LEFT"!==t.direction)throw new Error("Task direction must be right or left, but it is actually ".concat(t.direction));if("NONE"===this.shape)throw new Error("Cannot add a task to edge that have no node");"LEFT"===this.nodes.shape||"BOTH"===this.nodes.shape&&"LEFT"===t.direction?this._push(t,"LEFT"):this._push(t,"RIGHT")}},{key:"_push",value:function(t,e){if("right"!==(e=e.toLowerCase())&&"left"!==e)throw new Error("Edge _push called with bad direction: ".concat(e));t.speed=this.speed,t.destination=this.nodes[e].position,this.tasks[e].push(t)}},{key:"next",value:function(){this._next("RIGHT"),this._next("LEFT")}},{key:"_next",value:function(t){if("right"!==(t=t.toLowerCase())&&"left"!==t)throw new Error("Edge _next called with bad direction: ".concat(t));var e=[],i=!0,n=!1,r=void 0;try{for(var o,s=this.tasks[t][Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value;a.next(),a.arrive?this.nodes[t].push(a):e.push(a)}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}this.tasks[t]=e}},{key:"draw",value:function(){"BOTH"===this.nodes.shape&&(t.fill(0),t.line(this.nodes.left.position.x,this.nodes.left.position.y,this.nodes.right.position.x,this.nodes.right.position.y))}}]),e}(),g=function(){function e(t,n,r,o,s){i(this,e),this.name=t,this.color=n,this.position=r,this.cpu=o,this.power=s,this.tasks=new p,this.edges=new v,this.webId=0}return r(e,[{key:"reset",value:function(){this.tasks=new p}},{key:"link",value:function(t,e){var i=!0,n=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var a=o.value,l=new w;"RIGHT"===e?("LB"===a.name&&(l.speed=2),l.nodes.left=this,l.nodes.right=a,this.edges.right.push(l)):"LEFT"===e&&("LB"===this.name&&(l.speed=2),l.nodes.right=this,l.nodes.left=a,this.edges.left.push(l))}}catch(t){n=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}},{key:"push",value:function(t){if(t.power=this.power,t.speed=1,t.position=this.position.copy(),"RIGHT"===t.direction)t.destination=this.position.copy(),this.tasks.right.push(t);else{if("LEFT"!==t.direction)throw new Error("Bad task direction: ".concat(t.direction));t.destination=this.position.copy(),this.tasks.left.push(t)}}},{key:"next",value:function(){for(var e=this.cpu;e>0&&(this.tasks.right.length>0||this.tasks.left.length>0);){if(this.tasks.right.length>0)if(this.tasks.right[0].power<=e){var i=this.tasks.right.shift();if(e-=i.power,i.power=0,"BOTH"===this.edges.shape||"RIGHT"===this.edges.shape)"LB"===this.name?(this.edges.right[this.webId].push(i),i.webId=this.webId,this.webId=(this.webId+1)%3):t.random(this.edges.right).push(i);else{if("LEFT"!==this.edges.shape)throw new Error("Node ".concat(this.name," has no edge"));i.direction="LEFT",this.edges.left[i.webId].push(i)}}else this.tasks.right[0].power-=e/2,e/=2;if(this.tasks.left.length>0)if(this.tasks.left[0].power<=e){var n=this.tasks.left.shift();if(e-=n.power,n.power=0,"BOTH"===this.edges.shape||"LEFT"===this.edges.shape){var r=c.indexOf(n.color);(-1!==r&&"LB"===this.name?this.edges.left[r]:t.random(this.edges.left)).push(n)}else if("RIGHT"!==this.edges.shape)throw new Error("Node has no edge")}else this.tasks.left[0].power-=e,e=0}for(var o=0;o<this.tasks.right.length;o++)this.tasks.right[o].destination=t.createVector(this.position.x+20,this.position.y+20*o);for(var s=0;s<this.tasks.left.length;s++)this.tasks.left[s].destination=t.createVector(this.position.x-20,this.position.y-20*s);var a=!0,l=!1,h=void 0;try{for(var u,f=this.edges.both[Symbol.iterator]();!(a=(u=f.next()).done);a=!0){u.value.next()}}catch(t){l=!0,h=t}finally{try{a||null==f.return||f.return()}finally{if(l)throw h}}var d=!0,p=!1,y=void 0;try{for(var v,w=this.tasks.both[Symbol.iterator]();!(d=(v=w.next()).done);d=!0){v.value.next()}}catch(t){p=!0,y=t}finally{try{d||null==w.return||w.return()}finally{if(p)throw y}}}},{key:"draw",value:function(){t.fill(this.color),t.rect(this.position.x-40,this.position.y-30,80,60),"white"===this.color?t.fill("black"):t.fill("white"),t.text(this.name,this.position.x-32,this.position.y-12),t.text("".concat(this.tasks.both.length),this.position.x-32,this.position.y)}},{key:"createTask",value:function(){var t=new k(this.color);return this.push(t),t}}]),e}(),k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"RIGHT";i(this,e),this.color=t,this.direction=n,this.position=null,this.destination=null,this.speed=null,this.power=null,this.size=15,this.webId=null}return r(e,[{key:"next",value:function(){if(null===this.position||null===this.destination||null===this.speed)throw new Error("Bad task property");var t=this.destination.copy().sub(this.position).normalize().mult(this.speed);this.position.add(t)}},{key:"draw",value:function(){t.fill(this.color),t.ellipse(this.position.x,this.position.y,this.size),t.fill("black")}},{key:"distance",get:function(){if(null===this.destination||null===this.position)throw new Error("Bad task property");return p5.Vector.dist(this.position,this.destination)}},{key:"arrive",get:function(){return this.distance<this.speed/2+1}}]),e}(),b=function(){function e(n,r,o,s,a,l){i(this,e),this.label=l,this.slider=t.createSlider(n,r,o),this.slider.position(s,a)}return r(e,[{key:"draw",value:function(){var e="function"==typeof this.label?this.label(this.value):this.label;t.text(e,this.slider.x+this.slider.width,this.slider.y+5)}},{key:"value",get:function(){return this.slider.value()}}]),e}();t.setup=function(){t.createCanvas(1280,1024);for(var i=1;i<6;i++){var r=t.createVector(100,100*i);a.push(new g("PC#".concat(i),c[i-1],r,10,0))}u=new g("LB","white",t.createVector(400,300),3,30);for(var d=1;d<4;d++){var p=t.createVector(700,200*d-100);l.push(new g("WEB#".concat(d),"white",p,1,30))}f=new g("DB","white",t.createVector(1e3,300),3,30);for(var y=0,v=a;y<v.length;y++){v[y].link([u],"RIGHT")}u.link(l,"RIGHT"),u.link(a,"LEFT");for(var w=0,k=l;w<k.length;w++){var x=k[w];x.link([f],"RIGHT"),x.link([u],"LEFT")}f.link(l,"LEFT"),h=[].concat(a,[u],l,[f]);var T=t.createButton("Reset");T.position(10,10),T.mousePressed(function(){var t=!0,e=!1,i=void 0;try{for(var n,r=h[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var o=n.value,s=!0,a=!1,l=void 0;try{for(var u,f=o.edges.both[Symbol.iterator]();!(s=(u=f.next()).done);s=!0){u.value.reset()}}catch(t){a=!0,l=t}finally{try{s||null==f.return||f.return()}finally{if(a)throw l}}o.reset()}}catch(t){e=!0,i=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw i}}});var m=t.createButton("Add Request");m.position(10,40),m.mousePressed(function(){t.random(a).createTask()}),e=new b(0,10,3,200,10,function(t){return"リクエスト数：".concat(t,"tps")}),n=new b(0,10,3,200,40,function(t){return"LB性能:".concat(t,"tps")}),o=new b(0,10,1,200,70,function(t){return"WEB/AP性能:".concat(t,"tps")}),s=new b(0,10,3,200,100,function(t){return"DB性能:".concat(t,"tps")})},t.draw=function(){t.background(255),e.draw(),n.draw(),o.draw(),s.draw(),t.random()<e.value/150&&t.random(a).createTask(),u.cpu=.4*n.value,f.cpu=.2*s.value;for(var i=0,r=l;i<r.length;i++){r[i].cpu=.4*o.value}var c=!0,d=!1,p=void 0;try{for(var y,v=h[Symbol.iterator]();!(c=(y=v.next()).done);c=!0){var w=y.value,g=!0,k=!1,b=void 0;try{for(var x,T=w.edges.both[Symbol.iterator]();!(g=(x=T.next()).done);g=!0){x.value.draw()}}catch(t){k=!0,b=t}finally{try{g||null==T.return||T.return()}finally{if(k)throw b}}}}catch(t){d=!0,p=t}finally{try{c||null==v.return||v.return()}finally{if(d)throw p}}var m=!0,E=!1,L=void 0;try{for(var B,I=h[Symbol.iterator]();!(m=(B=I.next()).done);m=!0){var S=B.value;S.draw(),S.next()}}catch(t){E=!0,L=t}finally{try{m||null==I.return||I.return()}finally{if(E)throw L}}var H=!0,O=!1,F=void 0;try{for(var R,_=h[Symbol.iterator]();!(H=(R=_.next()).done);H=!0){var G=R.value,P=!0,j=!1,N=void 0;try{for(var V,C=G.edges.both[Symbol.iterator]();!(P=(V=C.next()).done);P=!0){var M=V.value,z=!0,A=!1,D=void 0;try{for(var W,q=M.tasks.both[Symbol.iterator]();!(z=(W=q.next()).done);z=!0){W.value.draw()}}catch(t){A=!0,D=t}finally{try{z||null==q.return||q.return()}finally{if(A)throw D}}}}catch(t){j=!0,N=t}finally{try{P||null==C.return||C.return()}finally{if(j)throw N}}}}catch(t){O=!0,F=t}finally{try{H||null==_.return||_.return()}finally{if(O)throw F}}var J=!0,K=!1,Q=void 0;try{for(var U,X=h[Symbol.iterator]();!(J=(U=X.next()).done);J=!0){var Y=U.value,Z=!0,$=!1,tt=void 0;try{for(var et,it=Y.tasks.both[Symbol.iterator]();!(Z=(et=it.next()).done);Z=!0){et.value.draw()}}catch(t){$=!0,tt=t}finally{try{Z||null==it.return||it.return()}finally{if($)throw tt}}}}catch(t){K=!0,Q=t}finally{try{J||null==X.return||X.return()}finally{if(K)throw Q}}}})}]);