!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}n.r(e);var r=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.right=[],this.left=[]}var e,n,r;return e=t,(n=[{key:"both",get:function(){return this.right.concat(this.left)}}])&&i(e.prototype,n),r&&i(e,r),t}();function o(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.right=null,this.left=null}var e,n,i;return e=t,(n=[{key:"shape",get:function(){return this.right?this.left?"BOTH":"RIGHT":this.left?"LEFT":"NONE"}}])&&o(e.prototype,n),i&&o(e,i),t}();function s(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var l=4,h=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:l;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.speed=n,this.p5=e,this.tasks=new r,this.nodes=new a}var e,n,i;return e=t,(n=[{key:"reset",value:function(){this.tasks=new r}},{key:"taskDirection",value:function(t){if("RIGHT"!==t.direction&&"LEFT"!==t.direction)throw new Error("Task direction must be right or left, but it is actually ".concat(t.direction));if("NONE"===this.shape)throw new Error("Cannot add a task to edge that have no node");return"LEFT"===this.nodes.shape||"BOTH"===this.nodes.shape&&"LEFT"===t.direction?"LEFT":"RIGHT"}},{key:"push",value:function(t){var e=this.taskDirection(t).toLowerCase();t.speed=this.speed,t.destination=this.nodes[e].position,this.tasks[e].push(t)}},{key:"next",value:function(){this._next("RIGHT"),this._next("LEFT")}},{key:"_next",value:function(t){if("right"!==(t=t.toLowerCase())&&"left"!==t)throw new Error("Edge _next called with bad direction: ".concat(t));var e=[],n=!0,i=!1,r=void 0;try{for(var o,a=this.tasks[t][Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s.next(),s.arrive?this.nodes[t].push(s):e.push(s)}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}this.tasks[t]=e}},{key:"draw",value:function(){"BOTH"===this.nodes.shape&&(this.p5.fill(0),this.p5.line(this.nodes.left.position.x,this.nodes.left.position.y,this.nodes.right.position.x,this.nodes.right.position.y))}}])&&s(e.prototype,n),i&&s(e,i),t}();function u(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var f=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.right=[],this.left=[]}var e,n,i;return e=t,(n=[{key:"shape",get:function(){return this.right.length>0?this.left.length>0?"BOTH":"RIGHT":this.left.length>0?"LEFT":"NONE"}},{key:"both",get:function(){return this.right.concat(this.left)}}])&&u(e.prototype,n),i&&u(e,i),t}();function c(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var d=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RIGHT";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.p5=e,this.color=n,this.direction=i,this.position=null,this.destination=null,this.speed=null,this.power=null,this.size=15,this.webId=null}var e,n,i;return e=t,(n=[{key:"next",value:function(){if(null===this.position||null===this.destination||null===this.speed)throw new Error("Bad task property");var t=this.destination.copy().sub(this.position).normalize().mult(this.speed);this.position.add(t)}},{key:"draw",value:function(){this.p5.fill(this.color),this.p5.ellipse(this.position.x,this.position.y,this.size),this.p5.fill("black")}},{key:"distance",get:function(){if(null===this.destination||null===this.position)throw new Error("Bad task property");return p5.Vector.dist(this.position,this.destination)}},{key:"arrive",get:function(){return this.distance<this.speed/2+1}}])&&c(e.prototype,n),i&&c(e,i),t}(),p=["#c93a40","#0074bf","#56a764","#de9610","#65ace4","#f2cf01","#d16b16"];function v(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var y=function(){function t(e,n,i,o,a,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.p5=e,this.name=n,this.color=i,this.position=o,this.cpu=a,this.power=s,this.tasks=new r,this.edges=new f,this.webId=0}var e,n,i;return e=t,(n=[{key:"reset",value:function(){this.tasks=new r}},{key:"link",value:function(t,e){var n=!0,i=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;this._link(s,e)}}catch(t){i=!0,r=t}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}}},{key:"_link",value:function(t,e){var n="right"===(e=e.toLowerCase())?"left":"right",i=new h(this.p5);"LB"===t.name&&(i.speed=2),i.nodes[n]=this,i.nodes[e]=t,this.edges[e].push(i)}},{key:"push",value:function(t){t.power=this.power,t.speed=1,t.position=this.position.copy(),t.destination=this.position.copy(),this._push(t,t.direction)}},{key:"_push",value:function(t,e){if("right"!==(e=e.toLowerCase())&&"left"!==e)throw new Error("Bad task direction: ".concat(e));this.tasks[e].push(t)}},{key:"next",value:function(){for(var t=this.cpu;t>0&&(this.tasks.right.length>0||this.tasks.left.length>0);){if(this.tasks.right.length>0)if(this.tasks.right[0].power<=t){var e=this.tasks.right.shift();if(t-=e.power,e.power=0,"BOTH"===this.edges.shape||"RIGHT"===this.edges.shape)"LB"===this.name?(this.edges.right[this.webId].push(e),e.webId=this.webId,this.webId=(this.webId+1)%3):this.p5.random(this.edges.right).push(e);else{if("LEFT"!==this.edges.shape)throw new Error("Node ".concat(this.name," has no edge"));e.direction="LEFT",this.edges.left[e.webId].push(e)}}else this.tasks.right[0].power-=t/2,t/=2;if(this.tasks.left.length>0)if(this.tasks.left[0].power<=t){var n=this.tasks.left.shift();if(t-=n.power,n.power=0,"BOTH"===this.edges.shape||"LEFT"===this.edges.shape){var i=p.indexOf(n.color);(-1!==i&&"LB"===this.name?this.edges.left[i]:this.p5.random(this.edges.left)).push(n)}else if("RIGHT"!==this.edges.shape)throw new Error("Node has no edge")}else this.tasks.left[0].power-=t,t=0}for(var r=0;r<this.tasks.right.length;r++)this.tasks.right[r].destination=this.p5.createVector(this.position.x+20,this.position.y+20*r);for(var o=0;o<this.tasks.left.length;o++)this.tasks.left[o].destination=this.p5.createVector(this.position.x-20,this.position.y-20*o);var a=!0,s=!1,l=void 0;try{for(var h,u=this.edges.both[Symbol.iterator]();!(a=(h=u.next()).done);a=!0){h.value.next()}}catch(t){s=!0,l=t}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}var f=!0,c=!1,d=void 0;try{for(var v,y=this.tasks.both[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){v.value.next()}}catch(t){c=!0,d=t}finally{try{f||null==y.return||y.return()}finally{if(c)throw d}}}},{key:"draw",value:function(){this.p5.fill(this.color),this.p5.rect(this.position.x-40,this.position.y-30,80,60),"white"===this.color?this.p5.fill("black"):this.p5.fill("white"),this.p5.text(this.name,this.position.x-32,this.position.y-12),this.p5.text("".concat(this.tasks.both.length),this.position.x-32,this.position.y)}},{key:"createTask",value:function(){var t=new d(this.p5,this.color);return this.push(t),t}}])&&v(e.prototype,n),i&&v(e,i),t}();function w(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var b=function(){function t(e,n,i,r,o,a,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.p5=e,this.label=s,this.slider=this.p5.createSlider(n,i,r),this.slider.position(o,a)}var e,n,i;return e=t,(n=[{key:"draw",value:function(){var t="function"==typeof this.label?this.label(this.value):this.label;this.p5.text(t,this.slider.x+this.slider.width,this.slider.y+5)}},{key:"value",get:function(){return this.slider.value()}}])&&w(e.prototype,n),i&&w(e,i),t}();new p5(function(t){var e,n,i,r,o=[],a=[],s=[],l=null,h=null;t.setup=function(){t.createCanvas(1280,1024);for(var u=1;u<6;u++){var f=t.createVector(100,100*u);o.push(new y(t,"PC#".concat(u),p[u-1],f,10,0))}l=new y(t,"LB","white",t.createVector(400,300),3,30);for(var c=1;c<4;c++){var d=t.createVector(700,200*c-100);a.push(new y(t,"WEB#".concat(c),"white",d,1,30))}h=new y(t,"DB","white",t.createVector(1e3,300),3,30);for(var v=0,w=o;v<w.length;v++){w[v].link([l],"RIGHT")}l.link(a,"RIGHT"),l.link(o,"LEFT");for(var g=0,k=a;g<k.length;g++){var m=k[g];m.link([h],"RIGHT"),m.link([l],"LEFT")}h.link(a,"LEFT"),s=[].concat(o,[l],a,[h]);var x=t.createButton("Reset");x.position(10,10),x.mousePressed(function(){var t=!0,e=!1,n=void 0;try{for(var i,r=s[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value,a=!0,l=!1,h=void 0;try{for(var u,f=o.edges.both[Symbol.iterator]();!(a=(u=f.next()).done);a=!0){u.value.reset()}}catch(t){l=!0,h=t}finally{try{a||null==f.return||f.return()}finally{if(l)throw h}}o.reset()}}catch(t){e=!0,n=t}finally{try{t||null==r.return||r.return()}finally{if(e)throw n}}});var T=t.createButton("Add Request");T.position(10,40),T.mousePressed(function(){t.random(o).createTask()}),e=new b(t,0,10,3,200,10,function(t){return"リクエスト数：".concat(t,"tps")}),n=new b(t,0,10,3,200,40,function(t){return"LB性能:".concat(t,"tps")}),i=new b(t,0,10,1,200,70,function(t){return"WEB/AP性能:".concat(t,"tps")}),r=new b(t,0,10,3,200,100,function(t){return"DB性能:".concat(t,"tps")})},t.draw=function(){t.background(255),e.draw(),n.draw(),i.draw(),r.draw(),t.random()<e.value/150&&t.random(o).createTask(),l.cpu=.4*n.value,h.cpu=.2*r.value;for(var u=0,f=a;u<f.length;u++){f[u].cpu=.4*i.value}var c=!0,d=!1,p=void 0;try{for(var v,y=s[Symbol.iterator]();!(c=(v=y.next()).done);c=!0){var w=v.value,b=!0,g=!1,k=void 0;try{for(var m,x=w.edges.both[Symbol.iterator]();!(b=(m=x.next()).done);b=!0){m.value.draw()}}catch(t){g=!0,k=t}finally{try{b||null==x.return||x.return()}finally{if(g)throw k}}}}catch(t){d=!0,p=t}finally{try{c||null==y.return||y.return()}finally{if(d)throw p}}var T=!0,E=!1,O=void 0;try{for(var L,B=s[Symbol.iterator]();!(T=(L=B.next()).done);T=!0){var S=L.value;S.draw(),S.next()}}catch(t){E=!0,O=t}finally{try{T||null==B.return||B.return()}finally{if(E)throw O}}var I=!0,H=!1,P=void 0;try{for(var j,C=s[Symbol.iterator]();!(I=(j=C.next()).done);I=!0){var _=j.value,F=!0,R=!1,G=void 0;try{for(var N,V=_.edges.both[Symbol.iterator]();!(F=(N=V.next()).done);F=!0){var D=N.value,M=!0,z=!1,A=void 0;try{for(var W,q=D.tasks.both[Symbol.iterator]();!(M=(W=q.next()).done);M=!0){W.value.draw()}}catch(t){z=!0,A=t}finally{try{M||null==q.return||q.return()}finally{if(z)throw A}}}}catch(t){R=!0,G=t}finally{try{F||null==V.return||V.return()}finally{if(R)throw G}}}}catch(t){H=!0,P=t}finally{try{I||null==C.return||C.return()}finally{if(H)throw P}}var J=!0,K=!1,Q=void 0;try{for(var U,X=s[Symbol.iterator]();!(J=(U=X.next()).done);J=!0){var Y=U.value,Z=!0,$=!1,tt=void 0;try{for(var et,nt=Y.tasks.both[Symbol.iterator]();!(Z=(et=nt.next()).done);Z=!0){et.value.draw()}}catch(t){$=!0,tt=t}finally{try{Z||null==nt.return||nt.return()}finally{if($)throw tt}}}}catch(t){K=!0,Q=t}finally{try{J||null==X.return||X.return()}finally{if(K)throw Q}}}})}]);